<ng-template [ngxPermissionsOnly]="['ADMIN']">
    <div>Haha admin loh</div>
</ng-template>

<ng-container *ngIf="medicines$ | async as medicines; else loading">
    <table mat-table [dataSource]="medicines" matSort class="mat-elevation-z8">
        <ng-container matColumnDef="pharmacy">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Pharmacy </th>
            <td mat-cell *matCellDef="let element"> {{ element.pharmacy }} </td>
        </ng-container>
        
        <ng-container matColumnDef="term">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Medicine name </th>
            <td mat-cell *matCellDef="let element"> {{ element.term }} </td>
        </ng-container>
        
        <ng-container matColumnDef="count">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Count </th>
            <td mat-cell *matCellDef="let element"> {{ element.count }} </td>
        </ng-container>

        <ng-container matColumnDef="controls">
            <ng-template [ngxPermissionsOnly]="['USER']" [ngxPermissionsOnlyElse]="elseBlock">
                <th mat-header-cell *matHeaderCellDef> Controls </th>
                <td mat-cell *matCellDef="let element">
                    <button mat-flat-button color="warn" (click)="unBookItem(element)">
                        <mat-icon>exposure_neg_1</mat-icon>
                    </button>
                    <button mat-flat-button color="warn" (click)="bookItem(element)">
                        <mat-icon>exposure_plus_1</mat-icon>
                    </button>
                    <a
                        mat-flat-button
                        color="accent"
                        [href]="'https://en.wikipedia.org/wiki/' + element.term">wiki page</a>
                </td>
            </ng-template>
            <ng-template #elseBlock>
                <th mat-header-cell *matHeaderCellDef>ADMIN controls</th>
                <td mat-cell *matCellDef="let element">
                    <button 
                        mat-flat-button 
                        color="warn" 
                        (click)="deleteFromDb(element)">delete all</button>
                    <mat-form-field>
                        <mat-label>move to another pharmacy</mat-label>
                        <mat-select (selectionChange)="moveToPharmacy(element, $event.value)">
                            <mat-option>---------------</mat-option>
                            <mat-option *ngFor="let pharmacy of pharmaciesList" [value]="pharmacy">{{ pharmacy }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </td>
            </ng-template>
        </ng-container>
        
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="onItemClicked(row)"></tr>
    </table>
</ng-container>
<mat-paginator
    [pageSize]="10"
    [pageSizeOptions]="[5, 10, 25, 100]"
    showFirstLastButtons>
</mat-paginator>
<ng-template #loading>
    <mat-spinner></mat-spinner>
</ng-template>